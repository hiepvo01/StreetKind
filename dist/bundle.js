(()=>{var e={161:(e,t,n)=>{var o=!!(n.g===n.g.window&&n.g.URL&&n.g.Blob&&n.g.Worker);function r(e,t){var r,a=this;if(t=t||{},o)return r=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new n.g.Worker(n.g.URL.createObjectURL(new n.g.Blob([r],{type:"text/javascript"})));this.self=t,this.self.postMessage=function(e){setTimeout((function(){a.onmessage({data:e})}),0)},setTimeout(e.bind(t,t),0)}r.prototype.postMessage=function(e){var t=this;setTimeout((function(){t.self.onmessage({data:e})}),0)},e.exports=r},705:(e,t,n)=>{e.exports=n(169)},169:(e,t,n)=>{"use strict";var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=(o=n(577))&&o.__esModule?o:{default:o},i={nFrequencyBars:255,onAnalysed:null},c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},i,n),this.audioContext=t,this.audioInput=null,this.realAudioInput=null,this.inputPoint=null,this.audioRecorder=null,this.rafID=null,this.analyserContext=null,this.recIndex=0,this.stream=null,this.updateAnalysers=this.updateAnalysers.bind(this)}return r(e,[{key:"init",value:function(e){var t=this;return new Promise((function(n){t.inputPoint=t.audioContext.createGain(),t.stream=e,t.realAudioInput=t.audioContext.createMediaStreamSource(e),t.audioInput=t.realAudioInput,t.audioInput.connect(t.inputPoint),t.analyserNode=t.audioContext.createAnalyser(),t.analyserNode.fftSize=2048,t.inputPoint.connect(t.analyserNode),t.audioRecorder=new a.default(t.inputPoint);var o=t.audioContext.createGain();o.gain.value=0,t.inputPoint.connect(o),o.connect(t.audioContext.destination),t.updateAnalysers(),n()}))}},{key:"start",value:function(){var e=this;return new Promise((function(t,n){e.audioRecorder?(e.audioRecorder.clear(),e.audioRecorder.record(),t(e.stream)):n("Not currently recording")}))}},{key:"stop",value:function(){var e=this;return new Promise((function(t){e.audioRecorder.stop(),e.audioRecorder.getBuffer((function(n){e.audioRecorder.exportWAV((function(e){return t({buffer:n,blob:e})}))}))}))}},{key:"updateAnalysers",value:function(){if(this.config.onAnalysed){requestAnimationFrame(this.updateAnalysers);var e=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(e);for(var t=new Array(255),n=0,o=void 0,r=0;r<255;r+=1)0!=(o=Math.floor(e[r])-Math.floor(e[r])%5)&&(n=r),t[r]=o;this.config.onAnalysed({data:t,lineTo:n})}}},{key:"setOnAnalysed",value:function(e){this.config.onAnalysed=e}}]),e}();c.download=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";a.default.forceDownload(e,t+".wav")},t.default=c},577:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=(o=n(161))&&o.__esModule?o:{default:o},i={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},c=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},i,n),this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(e){if(o.recording){for(var t=[],n=0;n<o.config.numChannels;n++)t.push(e.inputBuffer.getChannelData(n));o.worker.postMessage({command:"record",buffer:t})}},t.connect(this.node),this.node.connect(this.context.destination),this.worker=new a.default((function(){var e=0,t=[],n=void 0,o=void 0;function r(){for(var e=0;e<o;e++)t[e]=[]}function a(e,t){for(var n=new Float32Array(t),o=0,r=0;r<e.length;r++)n.set(e[r],o),o+=e[r].length;return n}function i(e,t,n){for(var o=0;o<n.length;o+=1)e.setUint8(t+o,n.charCodeAt(o))}this.onmessage=function(c){switch(c.data.command){case"init":!function(e){n=e.sampleRate,o=e.numChannels,r()}(c.data.config);break;case"record":!function(n){for(var r=0;r<o;r++)t[r].push(n[r]);e+=n[0].length}(c.data.buffer);break;case"exportWAV":!function(r){for(var c=[],s=0;s<o;s++)c.push(a(t[s],e));var u,l,d,f=(u=2===o?function(e,t){for(var n=e.length+t.length,o=new Float32Array(n),r=0,a=0;r<n;)o[r++]=e[a],o[r++]=t[a],a++;return o}(c[0],c[1]):c[0],l=new ArrayBuffer(44+2*u.length),i(d=new DataView(l),0,"RIFF"),d.setUint32(4,36+2*u.length,!0),i(d,8,"WAVE"),i(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,o,!0),d.setUint32(24,n,!0),d.setUint32(28,4*n,!0),d.setUint16(32,2*o,!0),d.setUint16(34,16,!0),i(d,36,"data"),d.setUint32(40,2*u.length,!0),function(e,t,n){for(var o=0;o<n.length;o++,t+=2){var r=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(d,44,u),d),h=new Blob([f],{type:r});this.postMessage({command:"exportWAV",data:h})}(c.data.type);break;case"getBuffer":!function(){for(var n=[],r=0;r<o;r++)n.push(a(t[r],e));this.postMessage({command:"getBuffer",data:n})}();break;case"clear":e=0,t=[],r()}}}),{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(e){var t=o.callbacks[e.data.command].pop();"function"==typeof t&&t(e.data.data)}}return r(e,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker.postMessage({command:"exportWAV",type:t})}}]),e}();c.forceDownload=function(e,t){var n=document.createElement("a");n.style="display: none",document.body.appendChild(n);var o=window.URL.createObjectURL(e);n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o),document.body.removeChild(n)},t.default=c}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e,t,o,r=n(705),a=function(){console.log("askQuestions function is called");var e=[{question:"Gender",type:"radio",options:["Male","Female","Non-Binary"]},{question:"Age Group",type:"radio",options:["< 18","18-25","> 25"]},{question:"Alone",type:"radio",options:["Yes","No"]},{question:"Intoxication Signs",type:"checkbox",options:["Speech","Balance","Co-ordination","Behavior","Not Visible"]},{question:"Escort",type:"checkbox",options:["Accommodation","Transport","Friends","Other"]},{question:"Basic Aid",type:"checkbox",options:["Vomit Bag","Water","Footwear"]},{question:"Describe your experience",type:"text"}];document.getElementById("questions").innerHTML=e.map((function(e,t){return"radio"===e.type?'<div class="col-md-4">\n                <div class="form-group">\n                    <p>'.concat(e.question,"</p>\n                    ").concat(e.options.map((function(e){return'<div class="form-check">\n                        <input class="form-check-input" type="radio" name="q'.concat(t,'" value="').concat(e,'">\n                        <label class="form-check-label">').concat(e,"</label>\n                    </div>")})).join(""),"\n                </div>\n            </div>"):"checkbox"===e.type?'<div class="col-md-4">\n                <div class="form-group">\n                    <p>'.concat(e.question,"</p>\n                    ").concat(e.options.map((function(e){return'<div class="form-check">\n                        <input class="form-check-input" type="checkbox" name="q'.concat(t,'" value="').concat(e,'">\n                        <label class="form-check-label">').concat(e,"</label>\n                    </div>")})).join(""),"\n                </div>\n            </div>"):"text"===e.type?'<div class="col-12">\n                <div class="form-group">\n                    <p>'.concat(e.question,'</p>\n                    <textarea class="form-control form-control-textarea" name="q').concat(t,'"></textarea>\n                </div>\n            </div>'):void 0})).join(""),console.log("Questions rendered in HTML"),fetch("/ask_questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({questions:e})}).then((function(e){if(console.log("askQuestions API response status:",e.status),!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(t){console.log("askQuestions response data:",t),t.answers&&t.answers.forEach((function(t,n){var o=e[n].type;if("radio"===o)document.querySelectorAll('input[name="q'.concat(n,'"]')).forEach((function(e){t.answer.includes(e.value)&&(e.checked=!0)}));else if("checkbox"===o){var r=t.answer.includes(",")?t.answer.split(",").map((function(e){return e.trim()})):[t.answer.trim()];document.querySelectorAll('input[name="q'.concat(n,'"]')).forEach((function(e){r.includes(e.value)&&(e.checked=!0)}))}else"text"===o&&(document.querySelector('textarea[name="q'.concat(n,'"]')).value=t.answer)}))})).catch((function(e){console.error("Error in askQuestions fetch:",e)}))};document.getElementById("start-btn").addEventListener("click",(function(){fetch("/start_recording",{method:"POST"}).then((function(e){return e.json()})).then((function(n){document.getElementById("status").innerText=n.message,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(n){t=new(window.AudioContext||window.webkitAudioContext),o=n,(e=new r.default(t)).init(n),e.start(),console.log("Recording started")})).catch((function(e){console.error("Error getting audio stream from getUserMedia",e)}))}))})),document.getElementById("stop-btn").addEventListener("click",(function(){fetch("/stop_recording",{method:"POST"}).then((function(e){return e.json()})).then((function(t){document.getElementById("status").innerText=t.message,e.stop().then((function(e){var t=e.blob;o.getAudioTracks()[0].stop(),function(e){var t=new FormData;t.append("audio_data",e,"recording.wav"),console.log("Uploading audio..."),fetch("/update_transcript",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(t){if(t.transcript){console.log("Transcript received:",t.transcript),document.getElementById("transcript").innerText=t.transcript.join("\n");var n=URL.createObjectURL(e),o=document.createElement("audio");o.controls=!0,o.src=n,document.getElementById("audio-playback").appendChild(o),console.log("Calling askQuestions function"),a()}else t.error&&console.error("Error:",t.error)})).catch((function(e){console.error("Error in uploadAudio fetch:",e)}))}(t),console.log("Recording stopped and exported as WAV")}))}))})),document.getElementById("review-submit-btn").addEventListener("click",(function(){console.log("Review and Submit button clicked");var e={};document.querySelectorAll("#questions .form-group").forEach((function(t,n){var o=t.querySelector("p").innerText,r="";if(t.querySelector('input[type="radio"]:checked'))r=t.querySelector('input[type="radio"]:checked').value;else if(t.querySelector("textarea"))r=t.querySelector("textarea").value;else{var a=[];t.querySelectorAll('input[type="checkbox"]:checked').forEach((function(e){a.push(e.value)})),r=a.join(", ")}e[o]=r})),console.log("Collected answers:",e),fetch("/save_answers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:e})}).then((function(e){return e.json()})).then((function(e){e.success?(console.log("Answers saved successfully"),window.location.href="/view_reports"):console.error("Error saving answers:",e.error)})).catch((function(e){console.error("Error in reviewAndSubmit fetch:",e)}))}))})()})();